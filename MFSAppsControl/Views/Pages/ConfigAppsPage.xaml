<Page x:Class="MFSAppsControl.Views.Pages.ConfigAppsPage"
      x:Name="AppsPageRoot"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:MFSAppsControl.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="ConfigAppsPage"
    d:DataContext="{d:DesignInstance local:ConfigAppsPage, IsDesignTimeCreatable=False}"
    d:DesignHeight="330"
    d:DesignWidth="800"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">

    <Page.Resources>
        <Style x:Key="NonInteractiveHeaderStyle" TargetType="DataGridColumnHeader">
            <Setter Property="IsHitTestVisible" Value="False"/>
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
        </Style>
        <Style x:Key="DeleteButtonStyle" TargetType="ui:Button" BasedOn="{StaticResource {x:Type ui:Button}}">
            <Setter Property="Visibility" Value="Collapsed"/>

            <Style.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=IsMouseOver}" Value="True">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Page.Resources>

    <Grid VerticalAlignment="Top">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <StackPanel Grid.RowSpan="2" Visibility="{Binding ViewModel.LoadingVisibility}" d:Visibility="Hidden" HorizontalAlignment="Center" VerticalAlignment="Center" >
            <ui:ProgressRing IsIndeterminate="True"  />
            <ui:TextBlock Text="{Binding ViewModel.LoadingText}" 
                            d:Text="Loading applications..." 
                            TextAlignment="Center"
                            Margin="0,12,0,0" 
                            FontStyle="Italic" />
        </StackPanel>
        <StackPanel Grid.RowSpan="2" Orientation="Vertical" Visibility="{Binding ViewModel.ErrorVisibility}" d:Visibility="Visible" HorizontalAlignment="Center" VerticalAlignment="Center">
            <TextBlock Text="{Binding ViewModel.ManagementEventWatcherErrorText}" d:Text="Error message" TextAlignment="Center" Foreground="Red" FontWeight="Bold" Margin="0,0,0,12" />
            <ui:Button Icon="{ui:SymbolIcon Open16}" Content="{Binding ViewModel.OpenIssueButtonText}" d:Content="Open a new bug issue" Appearance="Primary" HorizontalAlignment="Center" Click="OpenNewIssue_Click" />
        </StackPanel>
        <Grid Grid.Row="0" Margin="0,0,0,12" Visibility="{Binding ViewModel.DatagridVisibility}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <ui:Button 
                Icon="{ui:SymbolIcon Add16}"
                Appearance="Primary"
                Grid.Column="0"
                Click="NavigateToNewAddPage"/>
            <StackPanel
                x:Name="SimulationButtons"
                Orientation="Horizontal"
                Grid.Column="2"
                Margin="0,0,8,0"
                Visibility="Collapsed">
                <ui:Button 
                Icon="{ui:SymbolIcon Play16}"
                Appearance="Primary" Margin="0,0,4,0"
                Click="SimulateMfsStart_Click"/>
                <ui:Button 
                Icon="{ui:SymbolIcon Stop16}"
                Appearance="Primary" Margin="4,0,0,0"
                Click="SimulateMfsStop_Click"/>
            </StackPanel>
            <ui:ToggleSwitch
                x:Name="TestModeSwitch"
                Content="{Binding ViewModel.ToggleSwitchTestModeText}"
                d:Content="Test Mode"
                Grid.Column="4"
                Click="TestModeSwitch_Toggled"/>
        </Grid>
        <ui:DataGrid 
            ItemsSource="{Binding ViewModel.Apps, Mode=TwoWay}"
            SelectedItem="{Binding ViewModel.SelectedApp, Mode=TwoWay}"
            Visibility="{Binding ViewModel.DatagridVisibility}"
            Grid.Row="1" 
            HeadersVisibility="Column"
            CanUserResizeRows="False"
            CanUserReorderColumns="False"
            CanUserResizeColumns="False"
            CanUserAddRows="False"
            CanUserDeleteRows="False"
            ScrollViewer.HorizontalScrollBarVisibility="Hidden"
            ColumnWidth="*"
            MinHeight="290"
            MaxHeight="290"
            AutoGenerateColumns="False">
            <ui:DataGrid.Columns>
                <DataGridTemplateColumn HeaderStyle="{StaticResource NonInteractiveHeaderStyle}" Width="Auto" CanUserSort="False" IsReadOnly="True">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Image Source="{Binding IconPath, Converter={StaticResource ExeIconToImageSourceConverter}}" Width="32" Height="32" Margin="0,0,12,0"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="Application" Binding="{Binding Name}" Width="*" CanUserSort="True" IsReadOnly="True" />
                <DataGridTextColumn Header="Path" Binding="{Binding ExecutablePath}" Visibility="Collapsed" Width="*" CanUserSort="False" IsReadOnly="True" />
                <DataGridTextColumn Header="Arguments" Binding="{Binding Arguments, Mode=TwoWay, UpdateSourceTrigger=LostFocus}" Width="*" CanUserSort="False" />
                <DataGridCheckBoxColumn Header="Auto Start" Binding="{Binding AutoStart, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="Auto" CanUserSort="True" />
                <DataGridCheckBoxColumn Header="Auto Close" Binding="{Binding AutoClose, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="Auto" CanUserSort="True" />
                <DataGridTemplateColumn Width="32">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ui:Button Icon="{ui:SymbolIcon Delete16}" Style="{StaticResource DeleteButtonStyle}" Appearance="Danger" Command="{Binding ViewModel.RemoveAppCommand, ElementName=AppsPageRoot}" CommandParameter="{Binding}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </ui:DataGrid.Columns>
        </ui:DataGrid>

    </Grid>
</Page>
